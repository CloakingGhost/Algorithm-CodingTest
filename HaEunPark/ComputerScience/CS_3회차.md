
# ORM & JPA

1. ORM 
	- Object-Relational Mapping
	- 객체와 관계형 데이터베이스를 매핑하여, 객체 지향적인 쿼리를 다룸 (= 테이블을 객체 지향적으로 다룬다)
	- 대표적으로 JPA, Hibernate가 있음
2. JPA
	- Java Persistence API : 자바의 ORM 표준
	- 실제 구현체가 아닌 인터페이스 모음으로, 대표적인 구현체로 Hibernate를 사용함
	- 특징
		- 장점
			- 객체지향적인 코드 작성이 가능하다.
				-  SQL 없이 객체 데이터를 저장하고 불러올 수 있음
			- 데이터베이스에 독립적인 개발이 가능하다.
				- 데이터베이스의 형태와 무관하게 개발 가능함
			- SQL을 직접 작성하지 않아도 된다.
				- 간단한 메서드 처리로 데이터에 대한 CRUD 가능
			- 1차 캐시, 지연 로딩 등의 성능 최적화 기능을 제공한다.
				- EntityManager..?
		- 단점
		    - 복잡한 쿼리는 직접 작성해야 할 수 있다.
3. Spring Data JPA
	- JPA를 더 편리하게 사용할 수 있도록 스프링에서 제공하는 프로젝트
	- 데이터를 CRUD하는 작업을 자동화
	- JpaRepository를 만들어줌
	- 특징
		- 장점
			- 인터페이스만으로 구현체를 만들어준다
			- 메소드 이름만으로 쿼리 생성이 가능하다
			- 페이징, 정렬 등 데이터 접근 코드를 자동으로 제공한다.
				- RequestParams로 page, size에 대한 데이터를 받아서 활용 가능 (ex. 페이지네이션 실습)
			- 반복적인 CRUD 작업을 위한 공통 인터페이스 제공한다.
				- 데이터에 대한 CRUD 작업을 자동화함
			- 명시적인 설정 없이도 JPA를 스프링과 통합해서 사용 가능하다.
		- 단점
		    - JPA와 마찬가지로 복잡한 쿼리 처리가 어려울 수 있다
		    - 메소드 이름이 길어질 수 있다 (findByLastnameAndFirstname 등)
		    - JPA/Hibernate를 이해하지 못하면 문제 해결이 어려울 수 있다 (추상화 레벨이 높음)

### JPA 연관관계

Q. 데이터베이스의 테이블과 Entity의 차이?
A. 테이블에서는 JOIN을 통해 시작점을 정할 수 있다.
하지만 Entity에서는 참조를 활용하여, 내가 가진 필드에만 접근할 수 있다

- 데이터베이스의 테이블 간 관계를 객체와 매핑하는 방법
- 객체의 참조와 테이블의 외래키를 매핑한다

### JPA 단방향, 양방향 연관관계

1. 단방향 연관관계
	- 한쪽의 엔티티만 다른 엔티티를 참조하는 것
2. 양방향 연관관계
	- 양쪽 엔티티가 서로를 참조하는 것
	- 이 때, FK를 가지지 않은 Entity에서 List 형태로 엔티티를 가질 수 있다.

### 연관관계의 종류

1. 다대일 (N : 1)
	- 데이터베이스의 FK가 존재하는 테이블에 작성한다.
		- `@ManyToOne` : 관계 표시
		- `@JoinColumn(name = "{필드명})_id"` : 외래키 매핑
		- `@Nullable`
2. 일대다 (1 : N)
	- 다대일의 상대 테이블
		- `@OneToMany` : 관계 표시
	-  내가 상대 쪽에 접근하고 싶을 때만 만들어줌
	- `@mappedBy`: 양방향 관계에서 연관관계의 주인을 지정
	    - 반대쪽 엔티티의 필드명을 값으로 설정한다.
	    - 큰 역할은 하지 않고, 내가 어떤 필드와 연결이 되어있는지 나타냄
	      : 나는 읽기만 가능하고, 주인에게 컨트롤 권한을 이항함
	    - 중계 테이블 생성을 막아줌


### 연관관계의 주인

- 누가 연관관계에서 주도권을 가지고 있는지를 나타냄
- FK를 가진 Entity가 연관관계의 주인이다.
	- 해당 테이블이 생성되어야 두 테이블 간의 연관관계가 생기기 때문
- 연관관계의 주인만이 외래키 등록, 수정이 가능하다.
